#!/bin/bash

project_dir="$1"

# Session name must be tmux-safe
session_name="$(basename "$project_dir")"
session_name="${session_name//./_}"
session_name="${session_name// /_}"

# Attach if exists
if tmux has-session -t "$session_name" 2>/dev/null; then
    exec tmux attach -t "$session_name"
fi

# Create new session with safe name but correct path
tmux new-session -d -s "$session_name" -c "$project_dir"

tmux source ~/.tmux.conf

tmux rename-window -t "$session_name":1 neovim
tmux new-window   -t "$session_name":2 -n terminal -c "$project_dir"
tmux select-window -t "$session_name":1

exec tmux attach -t "$session_name"
